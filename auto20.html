<html>

<head>

    <META Charset = "utf-8" />

<link rel="stylesheet" type="text/css" class="ui" href="stylesheets/semantic.min.css">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<link rel="stylesheet" href="stylesheets/auto20.css" />

<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
<![endif]-->


<style>
    #map { float: left; height: 800px; width: 73%; min-width: 420px;}
    #join { float: right; height: 800px; width: 25%; min-width: 200px;}
    #searchDiv { position:fixed; top: 20px; left: 60px; z-index: 1}
    #chatDiv { display:block; position:fixed; bottom: 20px; left: 60px; z-index: 1;
        width: 250px; height: 100px; background: white; border: 3px; border-radius: 10px; padding: 5px}



    /* add media querry for mobile here */
    
</style>

<script src="javascripts/lib/jquery-1.10.2.js"></script>
<script src="javascripts/lib/jquery-ui.js"></script>
<script src="javascripts/lib/underscore-min.js"></script>
<script src="javascripts/lib/backbone-min.js"></script>

<script src="javascripts/lib/tongwen_core.js"></script>
<script src="javascripts/lib/tongwen_table_pt2s.js"></script>
<script src="javascripts/lib/tongwen_table_t2s.js"></script>

<script src='https://cdn.firebase.com/v0/firebase.js'></script>
<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
<script src="http://leaflet.github.io/Leaflet.label/leaflet.label.js"></script>


<title>è‡ªå­¸2.0--åœ°åœ–å¼çš„äº’åŠ©é€šè¨ŠéŒ„</title>
</head>

<body>

    <div id="searchDiv">
        <form id="searchbox" action="">
            <input id="search" type="text" data-ng-modle = "seekFriend" placeholder="è¼¸å…¥é—œéµå­—æ‰¾æœ‹å‹">
            <input id="goSearch" type="submit" value="å°‹æ‰¾">
        </form>
    </div>

    <div id="chatDiv">
        Chat: adasdda <br/>
        Chat2: adada Good!!
        <div id="chatInputDiv">
            <input type = 'text' placeholder = 'è¼¸å…¥æ‚¨çš„èŠå¤©è¨Šæ¯'></input>
        </div>

    </div>


    <div id="map">
    </div>
    <div id="join">
        <img src=""></img>
        <h1>ç«‹å³å‡èµ·æ‚¨çš„äº¤å‹æ——</h1>
        <div id = 'faq'><a>FAQ</a></div>
        <form>

            <h2>q1</h2>
            <input type = 'text' placeholder = 'ex1'></input>
            
            <h2>q2</h2>
            <input type = 'text' placeholder = 'ex1'></input>

            <h2>q3</h2>
            <input type = 'text' placeholder = 'ex1'></input>

            <h2>q3</h2>
            <input type = 'radio'>c1</input>
            <input type = 'radio'>c2</input>
            <input type = 'radio'>c3</input>

            <h2>q3</h2>
            <input type = 'checkbox'>è‡ªå­¸å®¶é•·</input>
            <input type = 'checkbox'>è‡ªå­¸ç”Ÿ</input>
            <input type = 'checkbox'>è‡ªä¸»æ•™å¸«</input><br />
            <input type = 'checkbox'>è‡ªå­¸åœ˜é«”</input>
            <input type = 'checkbox'>è‡ªä¸»ç”Ÿæ´»è€…</input>
            <input type = 'checkbox'>è‡ªè€•è¾²</input><br />
            <input type = 'checkbox'>å¾®å‹å‰µæ¥­è€…</input>


            <h2>q3</h2>
            <input type = 'text' placeholder = 'ex1'></input>

            <h2>Tags(for Search Engine)</h2>
            <span>ex tag1 <button>x</button></span>
            <input type = 'text' placeholder = 'ex1'></input> <button>Add tag</button>            
            <br/>
            <button>é è¦½</button>           
            <input type = 'submit'> é€å‡º </input>



        </form>
     </div>

<script>
    
    

    Auto20 = Backbone.View.extend({
        el: $('body'),

        events :{
            'click div#goSearch' : 'render'
        },

        initialize: function() {

            _.bindAll(this, 'render', 'feedback');

            
            this.osmUrl='http://{s}.tile.cloudmade.com/1dc4012079d54f93b27789a1fc4491e9/997/256/{z}/{x}/{y}.png';

            this.cloudmadeAttribution = 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade';

            this.LeafIcon = L.Icon.extend({
                    options: {
                        shadowUrl: 'img/leaf-shadow.png',
                        iconSize:     [38, 95],
                        shadowSize:   [50, 64],
                        iconAnchor:   [22, 94],
                        labelAnchor:  [-3, -76],
                        shadowAnchor: [4, 62],
                        popupAnchor:  [-3, -76]
                    }
            });

            this.icon = {green: new this.LeafIcon({iconUrl: 'img/leaf-green.png'}),
                        red : new this.LeafIcon({iconUrl: 'img/leaf-red.png'}),
                        orange : new this.LeafIcon({iconUrl: 'img/leaf-orange.png'})
                    };

            this.dataRef = new Firebase('https://we-autolearn.firebaseio.com');           
            
            this.render();
        },

        render: function() {

            var icon = this.icon;

//            var road_layer = new L.TileLayer(osmUrl, {
//                minZoom: 8,
  //              maxZoom: 18,
    //            attribution: '<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> CC-BY-SA, Tiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>',
  //              subdomains: '1234'
    //        });

      //      map.addLayer(road_layer);

//            map.setView(new L.LatLng(23.654299340, 120.44776492196047), 7);


            // å¦‚æœå­˜åœ¨ï¼Œå…ˆæ¸…ç†ä¸€æ¬¡   <==  å¾…åŠ 

            var tile = L.tileLayer(this.osmUrl, {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
            maxZoom: 18
        });  


            this.dataRef.once('value', function(dataSnapshot) {
                // store dataSnapshot for use in below examples.
                var markers = []; var circles = [];
     //           var markersIde = [];
     //           var markersHome = [];
      //          var markersGroup = [];
                var autos = dataSnapshot.val();

//                console.log(autos);
  //              console.log(autos.length);


                for (var i = 0; i < autos.length; i++) {

                    console.log(i);

                    var hand = autos[i];
                    if (!hand.name) {
                        console.log('ç•¥éç„¡åæ°'); continue
                    }

                    hand.latlngColumn.replace('(','').replace(')','');
                    console.log(hand.latlngColumn.split());

                    var colorIcon = icon.orange;

                    console.log(hand.name + hand.Style);
                    switch (hand.Style) {
                        case 'large_green' :
                            colorIcon = icon.green;                    break;
                        case 'large_yellow' :
                            colorIcon = icon.orange;                    break;
                        case 'large_blue' :
                            colorIcon = icon.red;                    break;
                        case 'large_red' :
                            colorIcon = icon.red;                    break;
                        default:
                            colorIcon = icon.orange;
                    }

                    var seek = !$('#search').val();

//                    var flag = hand.name+"<b>Hello world!</b><br />I am a popup.";
                    var flag = '<div class="flag" style="font-family: sans-serif;">'
                        +'<font color = "grey">åŠ å…¥æ™‚é–“: '+hand.æ™‚é–“æˆ³è¨˜+'</font><br />'
                        +'<h2> ğŸ‘ª '+hand.name+'ğŸ˜¼</h2><br />'
                        +hand.learner_birth+'å¹´æ¬¡çš„'+hand.learner_role+'ï¼Œä½åœ¨'+hand.address+'é™„è¿‘<br />'
                        +'<font color = "grey">ç¶“ç·¯åº¦: '+hand.latlngColumn+'</font>'
                        +'<br />'
                        +'<a href = "http://map.alearn.org.tw" target ="_blank" title = "æ›´å¤šè‡ªå­¸è³‡è¨Šï¼Œè«‹ä¸Šè‡ªå­¸åœ°åœ–"> <img height="100" width="120" src= "http://map.alearn.org.tw/images/automap.jpg" style = "float:right">  </a>'
                        +'<br />'
                        +'<b>ç¶²å€: </b>'+hand.site+'<br />'
                        +'<b>ç¤¾ç¾¤ç¶²å€: </b>'+hand.site2+'<br />'
                        +'<b>å…¬é–‹çš„è¯çµ¡æ–¹å¼:</b>'+hand.connect_me+'<br />'
                        +'<p align = "center"><b>æ­¡è¿è¯çµ¡!!</b></p><br />'
                        +'<br />'
                        +'<b>èˆˆè¶£åŒ…å«:</b>'+hand.learner_habit+'<br />'
                        +'<br />'
                        +'<b>å¯åˆ†äº«:</b>'+hand.share+'<br />'
                        +'<b>éœ€è¦:</b>'+hand.ask+'<br />'
                        +'<br />'
                        +'<b>è‡ªæˆ‘ä»‹ç´¹:</b>'+hand.note+'<br />'
                        +'<br />'
                        +'<hr>'
                        +'<b> <a href = "mailto:bestianhelp@gmail.com?subject=å›å ±åç‚º'+hand.name+'ã€æ™‚é–“æˆ³è¨˜ç‚º'+hand.æ™‚é–“æˆ³è¨˜+'çš„è³‡æ–™éŒ¯èª¤&body=ç¶²ç«™ç®¡ç†å“¡æ‚¨å¥½: æˆ‘è¦å›å ±åç‚º'+hand.name+'çš„è³‡æ–™éŒ¯èª¤ï¼Œè©³è«‹å¦‚ä¸‹ï¼š" title="å¦‚é‡éŒ¯èª¤èˆ‡æ¿«ç”¨ï¼Œè«‹æŒ‰æ­¤å›å ±ï¼Œè¬è¬!!">  å›å ±éŒ¯èª¤æˆ–æ¿«ç”¨ </a> </b>'
                        +'</div>'

                    

                    if (seek != true && flag.indexOf(seek) == -1) {
                        console.log(seek+'ï¼š'+flag.indexOf(seek)+'ç•¥é'+hand.name);
                        continue;
                    }

                    if (hand.latlngColumn.split(',').length != 2) {
                        console.log('LatLng:'+ hand.latlngColumn);
                        continue;
                    }

                    markers[i] = L.marker(hand.latlngColumn.split(','), {icon: colorIcon }).bindLabel(hand.name, { noHide: true }).bindPopup(flag);


 //                   circles[i] = L.circle(autos[i].latlngColumn.split(','), 500, {
   //                     color: 'green',
    //                    fillColor: '#3f0',
     //                   fillOpacity: 0.3
      //              }).addTo(map);

              //      labels[i] = new L.Label();
                //    labels[i].setContent(autos[i].name);
                  //  labels[i].setLatLng(autos[i].latlngColumn.split(','));
                  //  map.showLabel(labels[i]);;

  //                  var popup = L.popup();

    //                function onMapClick(e) {
        //                popup
      //                      .setLatLng(e.latlng)
            //                .setContent("You clicked the map at " + e.latlng.toString())
          //                  .openOn(map);
          //          }
        //            map.on('click', onMapClick);

                };


//                console.log("Mark"+markers);

                var goodMarkers = [];

                for (var i = 0; i < markers.length; i++) {
                    if (!markers[i]) {
                        console.log("Bad marker:"+i);
                        continue;
           //         console.log(markers[i]);
             //       console.log(i);
               //     console.log(Object.keys(markers[i]));
                    }
                    goodMarkers.push(markers[i]);
                };


                var hands = L.layerGroup(goodMarkers);  // æ‰€æœ‰äºº

                console.log("AAA");

   //             addTo(map).showLabel(); 

                        // å®¶åº­

//                var ides = L.layerGroup(markersIde); // æ•™è‚²å·¥ä½œè€…

                        // åœ˜é«”


 //               var minimal   = L.tileLayer(this.osmUrl, {styleId: 22677, attribution: this.cloudmadeAttribution}),
  //                  midnight  = L.tileLayer(this.osmUrl, {styleId: 999,   attribution: this.cloudmadeAttribution}),
    //                motorways = L.tileLayer(this.osmUrl, {styleId: 46561, attribution: this.cloudmadeAttribution});

    //            var baseMaps = {
      //              "Minimal": minimal,
        //            "Night View": midnight
          //      };


                var map = L.map('map', {
                    center: new L.LatLng(23.654299340, 120.44776492196047),
                    zoom: 7,
                    layers: [tile, hands]
                });


                var overlayMaps = {
            //        "Motorways": motorways,
                    "Hands": hands
                };


                L.control.layers(overlayMaps).addTo(map);  // ä¹‹å¾Œå¯ä»¥è¨­åœ–å±¤ï¼šå®¶åº­, æ•™å¸«, è‡ªå­¸åœ˜é«”


                var intro = '<p>æ­¡è¿ä½¿ç”¨ã€Œè‡ªå­¸2.0ã€åœ°åœ–å¼äº’åŠ©é€šè¨ŠéŒ„ï¼ï¼'
            +'<p>è‡ªå­¸çš„è·¯ä¸å­¤å–®ï¼Œç›¸ä¿¡æ‚¨ä¸€å®šå¾ˆå¿«èƒ½æ‰¾åˆ°å¿—åŒé“åˆçš„æœ‹å‹èˆ‡å…±å­¸å¤¥ä¼´ğŸ‘¼</p>'
            +'<button type = "submit" style = "font-size:1.5rem">æ’ä¸Šæ‚¨çš„æ——å¹Ÿ</button>';

                var welcomeWord = L.popup().setLatLng([22.01, 124.26]).setContent("<div id = 'welcome' style = 'font-size:2rem'>"+intro+"</div>").openOn(map);
            });
        },

        feedback: function() {
        }

    });
    
    var auto20 = new Auto20();
    
    


    

    
//    var marker = L.marker([25.09, 121.535579]).addTo(map);
  //  marker.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
//

 //   var marker = L.marker([25.09, 121.5]).addTo(map);
   // marker.bindPopup("<div class = 'first' style = 'font-size:2rem'><b>Hello world!</b><br />I am a popup.</div>").openPopup();

    
  //      $(".aaa").css('font-size', '200%');
        

</script>

</body>


</hmtl>